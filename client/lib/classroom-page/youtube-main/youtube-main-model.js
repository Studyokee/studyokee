(function(){define(["dictionary.model","songs.data.provider","youtube.player.model","subtitles.scroller.model","backbone"],function(a,b,c,d,e){var f;return f=e.Model.extend({initialize:function(){var e=this;return this.dataProvider=new b(this.get("settings")),this.youtubePlayerModel=new c({settings:this.get("settings")}),this.subtitlesScrollerModel=new d({settings:this.get("settings")}),this.dictionaryModel=new a({fromLanguage:this.get("settings").get("fromLanguage").language,toLanguage:this.get("settings").get("toLanguage").language,settings:this.get("settings")}),this.on("change:currentSong",function(){return console.log("YoutubeMainModel:change current song"),e.youtubePlayerModel.set({currentSong:e.get("currentSong")}),e.subtitlesScrollerModel.set({currentSong:e.get("currentSong")}),e.getSubtitles(e.get("currentSong"))}),this.on("change:subtitles",function(){return console.log("YoutubeMainModel:change subtitles"),e.youtubePlayerModel.set({subtitles:e.get("subtitles")}),e.subtitlesScrollerModel.set({subtitles:e.get("subtitles"),translation:e.get("translation"),resolutions:e.get("resolutions")})}),this.on("change:vocabulary",function(){return e.subtitlesScrollerModel.set({vocabulary:e.get("vocabulary")})}),this.youtubePlayerModel.on("change:i",function(){return e.subtitlesScrollerModel.set({i:e.youtubePlayerModel.get("i")})}),this.dictionaryModel.on("vocabularyUpdate",function(a){return e.set({vocabulary:a})}),this.getVocabulary()},getSubtitles:function(a){var b,c=this;return console.log("YoutubeMainModel: retrieved song data"),null==a?void this.youtubePlayerModel.set({subtitles:[],processedLines:[]}):(this.set({lastCallbackId:a._id}),b=function(a){var b,d,e,f,g;if(c.get("lastCallbackId")===a._id){if(d={},null!=(null!=a?a.resolutions:void 0))for(e=a.resolutions,f=0,g=e.length;f<g;f++)b=e[f],d[b.word]=b.resolution;return console.log("YoutubeMainModel: update song data"),c.set({subtitles:a.subtitles,translation:a.translations[0].data,resolutions:d})}},this.getSong(a._id,b))},getVocabulary:function(){var a,b,c,d=this;return c=this.get("settings").get("user").id,a=this.get("settings").get("fromLanguage").language,b=this.get("settings").get("toLanguage").language,$.ajax({type:"GET",url:"/api/vocabulary/"+a+"/"+b,dataType:"json",success:function(a){return d.set({vocabulary:null!=a?a.words:void 0})},error:function(a){return console.log("Error: "+a)}})},getSong:function(a,b){if(null!=a)return $.ajax({type:"GET",url:"/api/songs/"+a,dataType:"json",success:function(a){return b(a)},error:function(a){return console.log("Error: "+a)}})}})})}).call(this);